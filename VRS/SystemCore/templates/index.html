<!DOCTYPE html>
{% load static %}
<html lang="es">
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>CRUD Unificado</title>
        <link rel="stylesheet" href="{% static 'SystemCore/css/style.css' %}">
</head>
<body>
<div class="container">

<div class="header">
    <h1 class="title">CRUD Unificado - Django</h1>
    <div class="header-right">
        <small class="muted">Interfaz simple para gestionar vehículos y registros</small>
        {% if request.user.is_authenticated %}
            <span class="muted">Hola, {{ request.user.username }}</span>
            <form method="post" action="{% url 'logout' %}" class="inline-form">
                {% csrf_token %}
                <button type="submit" class="btn secondary btn space-left">Cerrar sesión</button>
            </form>
        {% else %}
            <a href="{% url 'login' %}" class="btn space-left">Iniciar sesión</a>
        {% endif %}
        <label class="theme-switch" for="theme-toggle">
            <input type="checkbox" id="theme-toggle" aria-label="Alternar tema oscuro">
            <span class="slider"></span>
        </label>
    </div>
</div>

<hr>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="alert {{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

<!-- ================= VEHICULOS ================= -->
<h2>Vehículos</h2>

<!-- FORM CREAR / EDITAR VEHÍCULO -->
<form method="POST" class="card">
    {% csrf_token %}

    <input type="hidden" name="vehiculo_id" id="vehiculo_id">

        <div>
            <label for="patente">Patente</label><br>
            <input name="patente" id="patente" placeholder="ABC123">
        </div>
        <div>
            <label for="marca">Marca</label><br>
            <input name="marca" id="marca" placeholder="Toyota">
        </div>
        <div>
            <label for="modelo">Modelo</label><br>
            <input name="modelo" id="modelo" placeholder="Corolla">
        </div>
        <div class="form-actions">
            <button type="submit" name="save_vehiculo" class="btn">Guardar</button>
            <button type="reset" class="btn secondary">Limpiar</button>
        </div>
    </form>

    <table class="data-table">
    <tr>
        <th>Patente</th>
        <th>Marca</th>
        <th>Modelo</th>
        <th>Acciones</th>
    </tr>

    {% for v in vehiculos %}
    <tr>
        <td>{{ v.patente }}</td>
        <td>{{ v.marca }}</td>
        <td>{{ v.modelo }}</td>
        <td>
            <div class="actions">
                            <button class="btn edit-vehiculo" 
                                data-id="{{ v.id }}" 
                                data-patente="{{ v.patente }}" 
                                data-marca="{{ v.marca }}" 
                                data-modelo="{{ v.modelo }}">Editar</button>

              <form method="POST" class="inline-form">
                  {% csrf_token %}
                  <input type="hidden" name="vehiculo_id" value="{{ v.id }}">
                  <button type="submit" name="delete_vehiculo" class="btn secondary">Eliminar</button>
              </form>
            </div>
        </td>
    </tr>
    {% endfor %}

</table>

<hr>

<!-- ================= REGISTROS ================= -->
<h2>Registros</h2>

<form method="POST" class="card">
    {% csrf_token %}

    <input type="hidden" name="registro_id" id="registro_id">

        <div>
            <label for="tipo_reg">Tipo</label><br>
            <input name="tipo" id="tipo_reg" placeholder="Inspección">
        </div>
        <div>
            <label for="desc_reg">Descripción</label><br>
            <input name="descripcion" id="desc_reg" placeholder="Descripción corta">
        </div>

        <div class="form-actions">
            <button type="submit" name="save_registro" class="btn">Guardar</button>
            <button type="reset" class="btn secondary">Limpiar</button>
        </div>
    </form>

    <table class="data-table">
    <tr>
        <th>Tipo</th>
        <th>Descripción</th>
        <th>Acciones</th>
    </tr>

    {% for r in registros %}
    <tr>
        <td>{{ r.tipo_registro }}</td>
        <td>{{ r.descripcion }}</td>
        <td>
            <div class="actions">
                            <button class="btn edit-registro" 
                                data-id="{{ r.id }}"
                                data-tipo="{{ r.tipo_registro }}"
                                data-desc="{{ r.descripcion }}">Editar</button>

              <form method="POST" class="inline-form">
                  {% csrf_token %}
                  <input type="hidden" name="registro_id" value="{{ r.id }}">
                  <button type="submit" name="delete_registro" class="btn secondary">Eliminar</button>
              </form>
            </div>
        </td>
    </tr>
    {% endfor %}

</table>

<hr>

<!-- =============== REGISTRO VEHICULO =============== -->
<h2>Registro de Vehículos</h2>

<form method="POST" class="card">
    {% csrf_token %}

    <input type="hidden" name="rv_id" id="rv_id">

        <div>
            <label for="rv_vehiculo">Vehículo</label><br>
            <select name="vehiculo" id="rv_vehiculo">
        {% for v in vehiculos %}
        <option value="{{ v.id }}">{{ v.patente }}</option>
        {% endfor %}
    </select>
        </div>

        <div>
            <label for="rv_registro">Registro</label><br>
            <select name="registro" id="rv_registro">
        {% for r in registros %}
        <option value="{{ r.id }}">{{ r.tipo_registro }}</option>
        {% endfor %}
    </select>
        </div>

        <div>
            <label for="rv_salida">Fecha salida</label><br>
            <input type="datetime-local" name="fecha_salida" id="rv_salida">
        </div>

        <div class="form-actions">
            <button type="submit" name="save_rv" class="btn">Guardar</button>
            <button type="reset" class="btn secondary">Limpiar</button>
        </div>
    </form>

    <table class="data-table">
    <tr>
        <th>Vehículo</th>
        <th>Registro</th>
        <th>Ingreso</th>
        <th>Salida</th>
        <th>Acciones</th>
    </tr>

    {% for rv in rv_list %}
    <tr>
        <td>{{ rv.vehiculo.patente }}</td>
        <td>{{ rv.registro.tipo_registro }}</td>
        <td>{{ rv.fecha_ingreso }}</td>
        <td>{{ rv.fecha_salida }}</td>

        <td>
            <div class="actions">
                            <button class="btn edit-rv"
                                data-id="{{ rv.id }}"
                                data-vehiculo="{{ rv.vehiculo.id }}"
                                data-registro="{{ rv.registro.id }}"
                                data-fecha="{{ rv.fecha_salida|date:"Y-m-d\\TH:i" }}">Editar</button>

              <form method="POST" class="inline-form">
                  {% csrf_token %}
                  <input type="hidden" name="rv_id" value="{{ rv.id }}">
                  <button type="submit" name="delete_rv" class="btn secondary">Eliminar</button>
              </form>
            </div>
        </td>
    </tr>
    {% endfor %}
  </table>

</div>

<script src="{% static 'SystemCore/js/theme.js' %}"></script>
</body>
</html>
